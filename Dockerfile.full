# Claude Code Sandbox - Full Variant
# Python + R + all cloud CLIs
FROM claude-sandbox-minimal

# Switch to root for installations
USER root

## Install lib dependencies, R/headers/base+recommended, CRAN packages
RUN apt-get update -qq && apt-get install -y --no-install-recommends \
    python3 python3-pip python3-dev python3-venv pipx \
    \
    libxml2-dev libfontconfig1-dev libharfbuzz-dev libfribidi-dev \
    libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev \
    \
    r-base r-base-dev r-recommended littler \
    \
    r-cran-tidyverse \
    \
    r-cran-patchwork r-cran-scales \
    \
    r-cran-devtools r-cran-usethis r-cran-testthat r-cran-roxygen2 \
    r-cran-rmarkdown r-cran-knitr r-cran-pak r-cran-renv \
    \
    r-cran-data.table r-cran-arrow \
    r-cran-readxl r-cran-writexl r-cran-haven r-cran-jsonlite r-cran-yaml \
    \
    r-cran-dbi r-cran-duckdb r-cran-rsqlite r-cran-odbc \
    \
    r-cran-lubridate r-cran-janitor \
    \
    google-cloud-cli azure-cli && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Install Python packages
RUN pip3 install --no-cache-dir \
    uv ipython cython \
    pytest pytest-cov \
    mypy black pylint flake8 \
    requests \
    hdf5 pyyaml unidecode xlrd psycopg2 sqlalchemy jinja2 \
    pandas numpy scipy scikit-learn statsmodels patsy networkx nltk spacy \
    matplotlib seaborn \
    \
    boto3 awscli \
    azure-cli azure-storage-blob azure-identity \
    google-cloud-storage google-cloud-bigquery google-cloud-compute

# Install AWS CLI v2
RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "/tmp/awscliv2.zip" && \
    unzip /tmp/awscliv2.zip -d /tmp && \
    /tmp/aws/install && \
    rm -rf /tmp/awscliv2.zip /tmp/aws

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

# Switch back to agent user
USER agent
WORKDIR /workspace
